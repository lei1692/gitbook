# Nginx简介

## 背景介绍
Nginx（发音为 "engine-x"）是一个开源的、高性能的 HTTP 服务器和反向代理服务器，也是一个 IMAP/POP3/SMTP 代理服务器。

它由 Igor Sysoev 于 2002 年开始开发，目的是解决 C10K 问题，即同时处理数万个网络连接的挑战。

Nginx 是一个非常流行的 web 服务器软件，通常被用于提供静态内容、负载均衡、以及作为反向代理等。
## 什么是web服务器
Web 服务器是一种能够处理 HTTP 请求并返回 HTTP 响应的软件或硬件。

它们托管和提供网站和 web 应用程序的内容，使得用户能够通过 web 浏览器访问这些内容。

### web 服务器的一些主要功能和组件：

1. **处理 HTTP 请求和返回响应:**
Web 服务器的核心功能是接收来自客户端（通常是 web 浏览器）的 HTTP 请求，处理这些请求，然后返回适当的 HTTP 响应。
这些响应通常包括 HTML 文件、图片、样式表（CSS）、JavaScript 文件等。
2. **提供静态和动态内容:**
静态内容：静态内容是预先创建的文件，如 HTML、CSS 和 JavaScript 文件、图像和视频。
Web 服务器可以直接为请求提供这些文件，无需任何额外的处理。
动态内容：动态内容是在请求时生成的，通常基于数据库数据或用户输入。
Web 服务器可能需要与应用服务器和数据库服务器交互以生成动态内容。
3. **安全:**
Web 服务器还负责处理安全相关的任务，例如 SSL/TLS 握手（用于 HTTPS）、身份验证和授权。
4. **日志和监控:**
记录请求和响应，以便于分析、监控和调试。
日志文件包含了有关服务器活动和性能的重要信息。
5. **配置和管理:**
Web 服务器提供了配置选项，允许管理员控制如何处理请求、管理连接、配置安全设置等。
6. **负载均衡和反向代理:**
在高流量环境中，web 服务器可以用作反向代理和/或负载均衡器，以分发流量到其他服务器，并确保服务的可靠性和性能。
7. **与应用服务器的交互:**
在某些配置中，web 服务器可能会将请求传递给后端的应用服务器，应用服务器再生成动态内容，并将内容返回给 web 服务器，最后由 web 服务器将内容传递给客户端。

### 常见的 Web 服务器软件包括：
- Apache HTTP Server: 一个开源、跨平台的 web 服务器软件。
- Nginx: 一个高性能、开源、跨平台的 HTTP 服务器和反向代理。
- Microsoft IIS (Internet Information Services): 一个用于 Windows Server 的 web 服务器和应用服务器。
- Apache Tomcat: 一个用于 Java 应用的 web 服务器和 servlet 容器。

Web 服务器是 web 应用架构的基础，它们处理客户端的请求，提供请求的内容，并确保 web 应用的安全和可靠。

## HTTP/POP3/SMTP/IMAP协议

### HTTP

**(HyperText Transfer Protocol)超文本传输协议**:

- **用途**：HTTP 是用于传输超文本（HTML 和相关资源）的协议，主要用于 web 浏览器和 web 服务器之间的通信。
- 特点：
  - **无状态**：每个 HTTP 请求都是独立的，服务器不保留之前请求的任何信息。
  - **可靠**：HTTP 基于 TCP，确保数据的可靠传输。
  - **简单和灵活**：HTTP 允许多种请求方法（例如 GET、POST、PUT、DELETE）、状态代码和头字段。

###  **POP3**

**(Post Office Protocol version 3)邮局协议的第三个版本**:

- **用途**：POP3 是一种用于从邮件服务器检索邮件的协议。
- 特点：
  - **简单**：POP3 适用于简单的邮件检索需求，它允许用户下载邮件并在本地存储。
  - **单一设备**：POP3 更适合于单一设备访问邮件，因为它通常会从服务器删除邮件。

### **SMTP **

**(Simple Mail Transfer Protocol)简单邮件传输协议**:

- **用途**：SMTP 是一种用于发送电子邮件的协议，通常用于邮件客户端到邮件服务器或邮件服务器到邮件服务器之间的通信。
- 特点：
  - **可靠**：SMTP 也基于 TCP，确保邮件的可靠传输。
  - **简单**：SMTP 是一个简单的文本协议，易于实现和调试。

### **IMAP **

**(Internet Mail Access Protocol)交互式邮件存取协议**:

- **用途**：IMAP 是一种更先进的邮件检索协议，允许用户在多个设备上访问邮件。
- 特点：
  - **多设备同步**：IMAP 允许在多个设备上保持邮件同步，因为邮件保留在服务器上。
  - **高级功能**：IMAP 提供了高级的邮件管理功能，如邮件标记、文件夹和搜索。

这些协议中的每一个都是为解决特定的通信问题而设计的。

HTTP 主要用于 web 通信，而 POP3、SMTP 和 IMAP 主要用于电子邮件的发送和接收。

在现代通信系统中，这些协议通常会一起工作，以提供丰富和可靠的用户体验。

## 正向代理和反向代理

### 正向代理

是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理服务器发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。

![](https://lwf-sky-take-out.oss-cn-beijing.aliyuncs.com/202311031013118.png)

### 反向代理

反向代理服务器位于用户与目标（原始）服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器，即用户直接访问反向代理服务器就可以获得目标服务器的资源。

同时，用户不需要知道目标服务器的地址，也无须在用户端作任何设定。

反向代理服务器通常可用来作为Web加速，即使用反向代理作为Web服务器的前置机来降低网络和服务器的负载，提高访问效率。

![image-20231103101412080](https://lwf-sky-take-out.oss-cn-beijing.aliyuncs.com/202311031014474.png)

### 正向代理和反向代理的区别

### 1. **代理对象**:

- **正向代理**：在客户端和目标服务器之间充当中介，代理客户端发出的请求。

  客户端直接连接到代理服务器，然后代理服务器连接到目标服务器以获取客户端所需的资源。

- **反向代理**：在目标服务器和客户端之间充当中介，代理来自客户端的请求到内部服务器。

  客户端连接到反向代理服务器，以为它是实际的目标服务器，但实际上反向代理将请求转发到内部服务器并返回结果。

### 2. **透明度**:

- **正向代理**：客户端通常知道正向代理的存在，并且需要配置以通过代理连接。
- **反向代理**：对于客户端来说，反向代理是透明的，客户端通常不知道反向代理的存在。

### 3. **使用场景**:

- **正向代理**：常用于缓存、过滤内容、网络访问控制、避免IP限制等。
  - 例如：学校或公司的网络管理员可能会设置正向代理来控制网络访问和过滤不适当的内容。
- **反向代理**：常用于负载均衡、缓存静态内容、保护和隐藏内部服务器、SSL终端处理等。
  - 例如：大型网站可能会使用反向代理来分发客户端请求到不同的服务器，以确保平滑运行和快速响应。

### 4. **部署位置**:

- **正向代理**：通常部署在网络的客户端侧。
- **反向代理**：通常部署在网络的服务器侧。

### 5. **地址转换**:

- **正向代理**：可能会修改客户端的请求地址。
- **反向代理**：可能会修改请求的目标地址。

## Nginx的优点

1. **速度更快、并发更高**

   单次请求或者高并发请求的环境下，Nginx都会比其他Web服务器响应 的速度更快。

   一方面在正常情况下，单次请求会得到更快的响应，另一 方面，在高峰期(如有数以万计的并发请求)，Nginx比其他Web服务器更快的响应请求。

   Nginx之所以有这么高的并发处理能力和这么好的性能原因在于Nginx采用了多进程和I/O多路复用(epoll)的底层实现。

2. **配置简单，扩展性强**

   Nginx的设计极具扩展性，它本身就是由很多模块组成，这些模块的使用可以通过配置文件的配置来添加。

   这些模块有官方提供的也有第三方提供的模块，如果需要完全可以开发服务自己业务特性的定制模块。

3. **高可靠性**

   Nginx采用的是多进程模式运行，其中有一个master主进程和N多个 worker进程，worker进程的数量我们可以手动设置，每个worker进程之间都是相互独立提供服务。

   并且master主进程可以在某一个worker进程出错时，快速去"拉起"新的worker进程提供服务。

4. **热部署**

   现在互联网项目都要求以7*24小时进行服务的提供，针对于这一要求， Nginx也提供了热部署功能，即可以在Nginx不停止的情况下，对Nginx 进行文件升级、更新配置和更换日志文件等功能。

5. **成本低、BSD许可证**

   BSD是一个开源的许可证，世界上的开源许可证有很多，现在比较流行 的有六种分别是GPL、BSD、MIT、Mozilla、Apache、LGPL。

   Nginx本身是开源的，我们不仅可以免费的将Nginx应用在商业领域，而且还可以在项目中直接修改Nginx的源码来定制自己的特殊要求。

   这些点也都是Nginx为什么能吸引无数开发者继续为Nginx来贡献自己的智慧和青春。

   ![](https://lwf-sky-take-out.oss-cn-beijing.aliyuncs.com/202311031042386.png)

## Nginx的功能特性及常用功能

Nginx提供的基本功能服务从大体上归纳为"基本HTTP服务"、“高级HTTP服务”和"邮件服务"等三大类。

### 基本HTTP服务

Nginx可以提供基本HTTP服务，可以作为HTTP代理服务器和反向代理服务器，支持通过缓存加速访问，可以完成简单的负载均衡和容错，支持包过滤功能，支持SSL等。

```
 处理静态文件、处理索引文件以及支持自动索引;
 提供反向代理服务器，并可以使用缓存加上反向代理，同时完成负载均衡和容错;
 提供对FastCGI、memcached等服务的缓存机制，同时完成负载均衡和容错; 
 使用Nginx的模块化特性提供过滤器功能。
 Nginx基本过滤器包括 gzip压缩、ranges支持、chunked响应、XSLT、SSI以及图像缩放等。其中针对包含多个SSI的页面，经由FastCGI或反向代理，SSI过滤器可以并行处理。
支持HTTP下的安全套接层安全协议SSL. 支持基于加权和依赖的优先权的HTTP/2
```

## Nginx 的一些关键特性和用途：

> Nginx 由于其轻量级和高性能，成为了现代 web 开发中广泛使用的服务器软件，尤其在高并发、大流量的 web 环境中。它可以独立运行，也可以与其他 web 服务器如 Apache 结合使用，以提高网站的性能和可靠性。

1. **高性能和高并发**:
   - Nginx 以其高性能、稳定性、低资源消耗和高并发处理能力而闻名，特别是在处理静态文件时效率极高。

2. **反向代理和负载均衡**:
   - Nginx 常用作反向代理服务器，将来自客户端的请求转发到内部服务器，并返回内部服务器的响应给客户端。它还可以作为负载均衡器，将流量分发到多个服务器，以提高响应速度和容错能力。

3. **静态文件服务**:
   - Nginx 可以高效地为客户端提供静态文件服务，包括 HTML、CSS、JavaScript 和图像文件。

4. **HTTP 和 HTTPS 服务器**:
   - Nginx 可以作为 HTTP 和 HTTPS 服务器，提供安全的 web 服务。

5. **邮件代理服务**:
   - Nginx 还可以作为 IMAP, POP3, 和 SMTP 代理服务器。

6. **模块化设计**:
   - Nginx 采用模块化设计，拥有丰富的模块库和第三方模块，可以通过安装不同的模块来扩展其功能。

7. **配置简单和灵活**:
   - Nginx 提供了灵活而直观的配置系统，使得配置和维护变得相对简单。

8. **跨平台**:
   - Nginx 可以在多种操作系统上运行，包括 Linux、Windows、macOS 等。

## Nginx常用的功能模块

``` js
静态资源部署 
Rewrite地址重写
	正则表达式 
反向代理
负载均衡 
	轮询、加权轮询、ip_hash、url_hash、fair
Web缓存 
环境部署
	高可用的环境 
用户认证模块
...
```

## Nginx的核心组成

1. 二进制可执行文件
2. 配置文件
3. 错误日志记录
4. 访问日志记录

``` java 
nginx二进制可执行文件 
nginx.conf配置文件 
error.log错误的日志记录 
access.log访问日志记录
```









